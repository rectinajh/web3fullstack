(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{224:function(t,a,s){t.exports=s.p+"assets/img/newLifecycle.13011d03.png"},403:function(t,a,s){t.exports=s.p+"assets/img/componentdiif.1dcf886c.png"},404:function(t,a,s){t.exports=s.p+"assets/img/moveChild.42f41513.png"},405:function(t,a,s){t.exports=s.p+"assets/img/oldLIfeCycle.70c9b886.png"},406:function(t,a,s){t.exports=s.p+"assets/img/react16.3.6713d323.png"},528:function(t,a,s){"use strict";s.r(a);var n=s(3),e=Object(n.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"_5-1-react-virtual-dom原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-react-virtual-dom原理"}},[t._v("#")]),t._v(" 5.1 React Virtual DOM原理")]),t._v(" "),a("h3",{attrs:{id:"_5-1-1-virtual-dom是什么"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-1-virtual-dom是什么"}},[t._v("#")]),t._v(" 5.1.1 Virtual DOM是什么？")]),t._v(" "),a("p",[t._v("官方定义：virtual DOM是一种编程理念（数据驱动视图），将ui虚拟的保持到内存中，并且通过某些库渲染成真实的dom，这个过程又叫做协调。")]),t._v(" "),a("p",[t._v("总结：virtual dom是一种编程理念，将ui节点抽象成js对象。")]),t._v(" "),a("h4",{attrs:{id:"ui节点抽象"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ui节点抽象"}},[t._v("#")]),t._v(" ui节点抽象")]),t._v(" "),a("p",[t._v("Learn Once，Write anywhere：因为提供了对HTML DOM的抽象，所以在web开发中，通常不需要去调用DOM API，也是因为抽象，所以React也可以开发Native（React Native）")]),t._v(" "),a("h4",{attrs:{id:"virtual-dom-构建ui"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#virtual-dom-构建ui"}},[t._v("#")]),t._v(" Virtual dom 构建UI")]),t._v(" "),a("p",[t._v("以我们经常见的web开发为例，来看下React是怎么通过Virtual DOM渲染成HTML元素的。")]),t._v(" "),a("div",{staticClass:"language-jsx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-jsx"}},[a("code",[t._v("    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("App")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Component")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        state"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("text")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Virtual DOM'")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("render")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("text"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token plain-text"}},[t._v("\n                    ")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("text"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token plain-text"}},[t._v("\n                ")]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token plain-text"}},[t._v("\n            )\n        }\n    }\n")])])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br")])]),a("p",[t._v("可以看到React是通过render方法渲染Virtual DOM ，从而绘制出真实DOM。意味着每次修改state的值就会执行render方法")]),t._v(" "),a("h3",{attrs:{id:"_5-1-2-virtual-dom-vs-原生dom"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-2-virtual-dom-vs-原生dom"}},[t._v("#")]),t._v(" 5.1.2 Virtual DOM VS 原生DOM")]),t._v(" "),a("ul",[a("li",[t._v("原生DOM更新")])]),t._v(" "),a("p",[t._v("DOM API 调用更新UI")]),t._v(" "),a("ul",[a("li",[t._v("Virtual DOM更新")])]),t._v(" "),a("ol",[a("li",[t._v("每次render都会产生一份新的’react dom‘")]),t._v(" "),a("li",[t._v("Virtual DOM要对新旧‘react dom’进行比较，从而确定在旧‘dom’的基础上进行多少变更")]),t._v(" "),a("li",[t._v("确定最优的变更策略之后调用DOM API更新")])]),t._v(" "),a("p",[t._v("Virtual DOM数据结构")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" globaldom"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("tagname")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'html'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("children")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("tagname")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'head'")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("tagname")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'body'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("children")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("tagName")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'div'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("attributes")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                      "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("className")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test'")]),t._v("\n                  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n         "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br")])]),a("p",[t._v("对UI节点抽象")]),t._v(" "),a("p",[t._v("在Virtual DOM中，对HTML节点进行抽象，用js对象的形式表示HTML")]),t._v(" "),a("p",[t._v("改变了过去对HTML节点的理解")]),t._v(" "),a("p",[t._v("呈现在用户面前的页面就是一个复杂的递归对象")]),t._v(" "),a("h3",{attrs:{id:"_5-1-3-virtual-dom-diff"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-3-virtual-dom-diff"}},[t._v("#")]),t._v(" 5.1.3 Virtual DOM Diff")]),t._v(" "),a("ul",[a("li",[t._v("Virtual DOM如何提搞性能")])]),t._v(" "),a("ol",[a("li",[t._v("我们将render产生的Virtual DOM简称 ‘Vdom’")]),t._v(" "),a("li",[t._v("通常调用setState方法触发Vdom更新")]),t._v(" "),a("li",[t._v("通过对比新旧‘Vdom’确定最优实现新的‘vdom’所需的操作")])]),t._v(" "),a("ul",[a("li",[t._v("Virtual DOM Diff的层次")])]),t._v(" "),a("ol",[a("li",[t._v("层级级别的比较")]),t._v(" "),a("li",[t._v("元素级别的比较")])]),t._v(" "),a("h4",{attrs:{id:"component-diff"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#component-diff"}},[t._v("#")]),t._v(" Component Diff")]),t._v(" "),a("p",[a("img",{attrs:{src:s(403),alt:""}})]),t._v(" "),a("p",[t._v("假设将图中的D节点更换成G节点，会把D节点删掉，然后创建G节点；只会同层级比较，这样会降低diff的复杂度，大概率下面的层级不一样的。")]),t._v(" "),a("h4",{attrs:{id:"element-diff"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#element-diff"}},[t._v("#")]),t._v(" Element Diff")]),t._v(" "),a("ol",[a("li",[t._v("createChild")]),t._v(" "),a("li",[t._v("moveChild")]),t._v(" "),a("li",[t._v("removeChild")])]),t._v(" "),a("p",[t._v("我们元素之间的对比中，会有3种情况：创建节点、删除节点、移动节点")]),t._v(" "),a("ul",[a("li",[t._v("创建节点")])]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("    "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("createChild")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("child"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("afterNode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("mountImage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("makeInserMarku")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mountImage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("afterNode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("child"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_mountIndex"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("ul",[a("li",[t._v("删除节点")])]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("    "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("removeChild")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("child"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("node")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("makeRemove")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("child，node"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("ul",[a("li",[t._v("移动节点")])]),t._v(" "),a("p",[t._v("假设我们把节点3移动到第一的位置")]),t._v(" "),a("p",[a("img",{attrs:{src:s(404),alt:""}})]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 老的节点和新的节点相同，说明需要移动节点")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("preChild"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v("nextChild"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    updates"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("enqueue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("updates"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("moveChild")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("preChild"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("lastPlaceNode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("nextIndex"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("lastIndex"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    lastIndex"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("Math"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("max")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("preChild"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_mountIndex"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("lastIndex"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    preChild"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_mountIndex"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("nextIndex\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 移动的方法")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("moveChild")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("child"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("afterNode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("toIndex"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("lastIndex")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// _mountIndex是这个元素在原有节点的顺序，lastIndex是这次要更新的顺序")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("child"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_mountIndex"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("lastIndex"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("makeMove")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("child"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("afterNode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("toIndex"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br")])]),a("p",[t._v("在实际中最后一个节点移动到第一位置的时候，不是把最后一个节点直接移动到第一的位置，而是把这个节点前面的节点依次往后移动，直到最后一个节点成为第一的位置。")]),t._v(" "),a("h3",{attrs:{id:"_5-1-3-扩展资料"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-3-扩展资料"}},[t._v("#")]),t._v(" 5.1.3 扩展资料")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://reactjs.org/docs/faq-internals.html#what-is-the-virtual-dom",target:"_blank",rel:"noopener noreferrer"}},[t._v("Virtual DOM 定义"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://mithril.js.org/vnodes.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Virtual DOM Node"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://reactkungfu.com/2015/10/the-difference-between-virtual-dom-and-dom/",target:"_blank",rel:"noopener noreferrer"}},[t._v("VDom与 DOM 的区别"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://juejin.im/entry/5af99e786fb9a07ac90d5664",target:"_blank",rel:"noopener noreferrer"}},[t._v("React性能优化：Virtual Dom原理浅析"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://juejin.im/post/5c504f736fb9a049ef26fcd3",target:"_blank",rel:"noopener noreferrer"}},[t._v("[译] Virtual Dom 和 Diff 算法"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"_5-2-react-reconciler-react协调的过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-react-reconciler-react协调的过程"}},[t._v("#")]),t._v(" 5.2 React Reconciler（react协调的过程）")]),t._v(" "),a("h3",{attrs:{id:"_5-2-1-react-reconclier-15版本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-1-react-reconclier-15版本"}},[t._v("#")]),t._v(" 5.2.1  React Reconclier(15版本)")]),t._v(" "),a("h2",{attrs:{id:"_5-3-new-componentlifecyle-新生命周期"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-new-componentlifecyle-新生命周期"}},[t._v("#")]),t._v(" 5.3 new componentLifecyle（新生命周期）")]),t._v(" "),a("h3",{attrs:{id:"_5-3-1-react组件新生命周期详解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-1-react组件新生命周期详解"}},[t._v("#")]),t._v(" 5.3.1 React组件新生命周期详解")]),t._v(" "),a("p",[t._v("老的生命周期")]),t._v(" "),a("p",[a("img",{attrs:{src:s(405),alt:""}})]),t._v(" "),a("p",[t._v("react 16.3 增加了getDeriveStateFromProps和getSnapshotBeforeUpdate 2个静态方法")]),t._v(" "),a("p",[a("img",{attrs:{src:s(406),alt:""}})]),t._v(" "),a("p",[t._v("react 16.4中增加了在setState和forceUpdate()都会执行这个静态方法"),a("code",[t._v("getDeriveStateFromProps")])]),t._v(" "),a("p",[a("img",{attrs:{src:s(224),alt:""}})]),t._v(" "),a("h3",{attrs:{id:"_5-3-2-挂载阶段"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-2-挂载阶段"}},[t._v("#")]),t._v(" 5.3.2 挂载阶段")]),t._v(" "),a("ol",[a("li",[t._v("挂载阶段的函数")])]),t._v(" "),a("ul",[a("li",[t._v("constructor 构造函数，初始化state，以及为事件处理函数绑定实例")]),t._v(" "),a("li",[t._v("getDeriveStateFromProps 新增的静态方法，返回一个新的state，或者是null，静态方法里的，这里面的this是指向全局变量")]),t._v(" "),a("li",[t._v("render 渲染函数")]),t._v(" "),a("li",[t._v("componentDidMount 挂载成功后立即调用")])]),t._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[t._v("更新阶段的函数")])]),t._v(" "),a("ul",[a("li",[t._v("getDeriveStateFromProps props变化或者state方法触发")]),t._v(" "),a("li",[t._v("shouldComponentUpdate 判断是否进行更新")]),t._v(" "),a("li",[t._v("render 函数")]),t._v(" "),a("li",[t._v("getSnapshotBeforeUpdate 生命周期方法在更新之前（如：更新 DOM 之前）被调用。此生命周期的返回值将作为第三个参数传递给 componentDidUpdate。（通常不需要，但在重新渲染过程中手动保留滚动位置等情况下非常有用。）")]),t._v(" "),a("li",[t._v("componentDidUpdate 更新后会被立即调用")])]),t._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[t._v("卸载阶段的函数")])]),t._v(" "),a("ul",[a("li",[t._v("componentWillUnmount 卸载函数，组件卸载及销毁之前直接调用，主要用于清除一些在组件生命周期订阅，真实DOM事件以及setTimeout/setinterval的返回值")])]),t._v(" "),a("h4",{attrs:{id:"异常捕获"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#异常捕获"}},[t._v("#")]),t._v(" 异常捕获")]),t._v(" "),a("ul",[a("li",[t._v("componentDidCatch 生命周期方法在后代组件抛出错误后被调用，方法接受两个参数（err，info），分别是错误信息和错误组件的栈信息")]),t._v(" "),a("li",[t._v("getDerivedStateFromError 在后代组件抛出错误后调用，接受一个参数（error）表示具体的错误信息")])]),t._v(" "),a("h3",{attrs:{id:"_5-3-3-新版组件升级"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-3-新版组件升级"}},[t._v("#")]),t._v(" 5.3.3 新版组件升级")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("componetWillMount (17.0被移除)")]),t._v(" "),a("ul",[a("li",[t._v("render 方法之前调用，在此调用setState并不会触发再次渲染")]),t._v(" "),a("li",[t._v("通常会在这个方法中进行页面标题的一些修改以及其他与再次render不相关的操作")])])]),t._v(" "),a("li",[a("p",[t._v("UNSAFE_componentWillMount （16.3 新增不安全的生命周期引入别名）")]),t._v(" "),a("ul",[a("li",[t._v("与state相关的操作挪到constructor方法中执行")]),t._v(" "),a("li",[t._v("异步操作挪到componentDidMount中执行")])])]),t._v(" "),a("li",[a("p",[t._v("componentWillUpdate(17.0被移除)")]),t._v(" "),a("ul",[a("li",[t._v("在组件收到新的props或state时，会在渲染之前调用")]),t._v(" "),a("li",[t._v("方法内不能调用setState，触发循环，内存泄漏")])])]),t._v(" "),a("li",[a("p",[t._v("UNSAFE_componentWillUpdate（16.3 新增不安全的生命周期引入别名）")]),t._v(" "),a("ul",[a("li",[t._v("应该在shouldComponentUpdate")])])]),t._v(" "),a("li",[a("p",[t._v("componentWillReceiveProps(17.0被移除)")]),t._v(" "),a("ul",[a("li",[t._v("接受父级传递过来最新的props，转化为组件内的state")]),t._v(" "),a("li",[t._v("判断是否进行更新或者执行异步请求数据")])])]),t._v(" "),a("li",[a("p",[t._v("UNSADFE_componentWillReceiveProps（16.3 新增不安全的生命周期引入别名）")]),t._v(" "),a("ul",[a("li",[t._v("与渲染相关的props直接渲染，不需要处理为组件内的state")]),t._v(" "),a("li",[t._v("异步数据请求在componentDidUpdate中处理")]),t._v(" "),a("li",[t._v("getDerivedStateFromPropss方法替换，需要考虑生命周期的执行顺序")])])])])])}),[],!1,null,null,null);a.default=e.exports}}]);